<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>fit a cox Non-proportional Hazards model with P-spline or Smoothing-spline, penalization coefficient is provided by cross validation — cv.coxtp • surtvep</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="fit a cox Non-proportional Hazards model with P-spline or Smoothing-spline, penalization coefficient is provided by cross validation — cv.coxtp"><meta property="og:description" content="Fit a cox Non-proportional Hazards model via penalized maximum likelihood."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-54921687-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-54921687-5');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surtvep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/surtvep.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Model_Parameters.html">Model Parameters</a>
    </li>
    <li>
      <a href="../articles/reference.html">Reference</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/UM-KevinHe/surtvep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>fit a cox Non-proportional Hazards model with P-spline or Smoothing-spline, penalization coefficient is provided by cross validation</h1>
    <small class="dont-index">Source: <a href="https://github.com/UM-KevinHe/surtvep/blob/HEAD/R/cv.coxtp.r" class="external-link"><code>R/cv.coxtp.r</code></a></small>
    <div class="hidden name"><code>cv.coxtp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit a cox Non-proportional Hazards model via penalized maximum likelihood.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cv.coxtp</span><span class="op">(</span></span>
<span>  <span class="va">event</span>,</span>
<span>  <span class="va">z</span>,</span>
<span>  <span class="va">time</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  foldid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penalty <span class="op">=</span> <span class="st">"Smooth-spline"</span>,</span>
<span>  nsplines <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  ties <span class="op">=</span> <span class="st">"Breslow"</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-09</span>,</span>
<span>  iter.max <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ProxN"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">1e+08</span>,</span>
<span>  btr <span class="op">=</span> <span class="st">"dynamic"</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  stop <span class="op">=</span> <span class="st">"ratch"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  lambda.spline <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fixedstep <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>event</dt>
<dd><p>response variable of length <code>nobs</code>, should be a vector containing 0 or 1</p></dd>


<dt>z</dt>
<dd><p>input covariate matrix, of dimension <code>nobs</code> * <code>nvars</code>; each row is an observation vector.</p></dd>


<dt>time</dt>
<dd><p>follow up time, should be a vector with non-negative numeric value</p></dd>


<dt>strata</dt>
<dd><p>stratification group defined in the data. If there exists stratification group, please enter as vector.
By default a non-stratified model would be implemented</p></dd>


<dt>nfolds</dt>
<dd><p>number of folds - default is 5. Although nfolds can be as large as the sample size (leave-one-out CV), it is not recommended for large datasets. Smallest value allowable is nfolds=3</p></dd>


<dt>foldid</dt>
<dd><p>an optional vector of values between 1 and nfold identifying what fold each observation is in. If supplied, nfold can be missing.</p></dd>


<dt>penalty</dt>
<dd><p>a character string specifying the spline term for Penalized Newton's Method.
This term is added to the log-partial likelihood as the new objective function to control the model's smoothness.</p>
<p><code>P-spline</code> stands for "Penalized B-spline". It combines the B-spline basis with a discrete quadratic penalty on the basis coefficients between adjacent knots.</p>
<p><code>Smooth-spline</code> refers to the Smoothing-spline, the derivative based penalties combined with B-splines. Default value is <code>Smooth-spline</code>.</p></dd>


<dt>nsplines</dt>
<dd><p>number of basis functions in the B-splines to span the time-varying effects, default value is 8.
We use the r function <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs</a></code> to generate the B-splines.</p></dd>


<dt>ties</dt>
<dd><p>a character string specifying the method for tie handling. If there are no tied
death times, the methods are equivalent.  By default <strong><code>ties="Breslow"</code></strong> uses the Breslow approximatio, this can be faster when many ties occured.</p></dd>


<dt>tol</dt>
<dd><p>convergence threshold for Newton's method. The algorithm continues until the method selected using <code>stop</code> converges.
The default value is  <code>1e-6</code>.</p></dd>


<dt>iter.max</dt>
<dd><p>maximum Iteration number, default value is  <code>20L</code>.</p></dd>


<dt>method</dt>
<dd><p>a character string specifying whether to use Newton's method or Proximal Newton's method.  If <code>"Newton"</code> then exact hessian is used,
while default method <code>"ProxN"</code> implementing the proximal method which can be faster and more stable when there exists ill-conditioned second-order information of the log-partial likelihood.
See details in Wu et al. (2022).</p></dd>


<dt>lambda</dt>
<dd><p>a user specified <code>lambda.spline</code> sequence as the penalization coefficients in front of the spline term specified by <code>spline</code>.
This is the tuning parameter for penalization. Users can use <code>IC</code> to select the best tuning parameter based on the information criteria.
Users can specify for larger values when the estimated time-varying effects are too high.
Default is <code>0</code> which refers to Newton's Method without penalization.</p></dd>


<dt>btr</dt>
<dd><p>a character string specifying the backtracking line search approach. <code>"dynamic"</code> is typical way to perform backtracking linesearch.
<code>"static"</code> limits the Newton's increment, and can achieve more stable results in some extreme cases such as ill-conditioned second-order information of the log-partial likelihood,
which usually occur when some predictors are categorical with low frequency for some categories.
Users should be careful with <code>static</code> as this may lead to underfitting.</p></dd>


<dt>tau</dt>
<dd><p>a scalar in (0,1) used to control the step size inside the back tracking linesearch. Default value is <code>0.5</code>.</p></dd>


<dt>stop</dt>
<dd><p>a character string specifying the stopping rule to determine convergence. Use <code>loglik(m)</code> to denote the log-partial likelihood at iteration step m.
<code>"incre"</code> means we stop the algorithm when Newton's increment is less than the <code>tol</code>.
<code>"relch"</code> means we stop the algorithm when the <code>loglik(m)</code> divided by the  <code>loglik(0)</code> is less than the <code>tol</code>.
<code>"ratch"</code> means we stop the algorithm when <code>(loglik(m)-loglik(m-1))/(loglik(m)-loglik(0))</code> is less than the <code>tol</code>.
<code>"all"</code> means we stop the algorithm when all the stopping rules <code>"incre"</code>, <code>"relch"</code> and <code>"ratch"</code> is met. Default value is <code>ratch</code>.</p></dd>


<dt>parallel</dt>
<dd><p>if <code>TRUE</code> then parallel computation is enabled. The number of threads to be used is determined by <code>threads</code>.</p></dd>


<dt>threads</dt>
<dd><p>an integer indicating the number of threads to be used for parallel computation. Default is <code>2</code>. If <code>parallel</code> is false, then the value of <code>threads</code> has no effect.</p></dd>


<dt>degree</dt>
<dd><p>degree of the piecewise polynomial for generating the B-spline basis functions---default is 3 for cubic splines.
<code>degree = 2</code> results in the quadratic B-spline basis functions.</p>
<p>If <code>penalty</code> is <code>Smooth-spline</code>, different choices of <code>degree</code> give different results.
When <code>degree=3</code>, we use the cubic B-spline penalizing the second order derivative, which reduces to a linear term.
When <code>degree=2</code>, we use the quadratic B-spline penalizing first order derivative, which reduces to a constant. See Wood (2016) for details.
Default is <code>degree=2</code>.</p></dd>


<dt>fixedstep</dt>
<dd><p>if <code>TRUE</code>, the algorithm will be forced to run <code>iter.max</code> steps regardless of the stopping criterion specified.</p></dd>


<dt>knots</dt>
<dd><p>the internal knot locations (breakpoints) that define the B-splines.
The number of the internal knots should be \(`nsplines`-`degree`-1\).
If <code>NULL</code>, the locations of knots are chosen to include an equal number of events within each time interval. This leads to more stable results in most cases.
Users can specify the internal knot locations by themselves.</p></dd>


<dt>gamma</dt>
<dd><p>parameter for Proximal Newton's Method <code>"ProxN"</code>. Default value is <code>1e8</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>model.cv</dt>
<dd><p>a <code>"coxtp"</code> object with penalization coefficient chosen based on cross validation</p></dd>

<dt>lambda.spline</dt>
<dd><p>the values of <code>lambda.spline</code> used in the fits.</p></dd>

<dt>cv.loglik</dt>
<dd><p>The mean log-partial likelihood on each fold after based on the model trained on remaining folds - a vector of length length(lambda.spline).</p></dd>

<dt>lambda.selected</dt>
<dd><p>Value of <code>lambda.spline</code> that gives maximum cv.loglik</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function runs <code>coxtp</code> <code>nfolds</code> times; each is to compute the fit with each of the folds omitted.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ExampleData</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">ExampleData</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-in"><span><span class="va">time</span>  <span class="op">&lt;-</span> <span class="va">ExampleData</span><span class="op">$</span><span class="va">time</span></span></span>
<span class="r-in"><span><span class="va">event</span> <span class="op">&lt;-</span> <span class="va">ExampleData</span><span class="op">$</span><span class="va">event</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lambda.spline</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span>   <span class="op">&lt;-</span> <span class="fu">cv.coxtp</span><span class="op">(</span>event <span class="op">=</span> <span class="va">event</span>, z <span class="op">=</span> <span class="va">z</span>, time <span class="op">=</span> <span class="va">time</span>, lambda<span class="op">=</span><span class="va">lambda.spline</span>, nfolds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in cv.coxtp(event = event, z = z, time = time, lambda = lambda.spline,     nfolds = 5):</span> could not find function "cv.coxtp"</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lingfeng Luo, Wenbo Wu, Xueting Tao.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

